<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/assets/css/userManage.css">
    <link href="/admin_assets/assets/node_modules/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/admin_assets/assets/node_modules/perfect-scrollbar/css/perfect-scrollbar.css" rel="stylesheet">
    <!-- This page CSS -->
    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>

    <!-- chartist CSS -->
    <link href="/admin_assets/assets/node_modules/morrisjs/morris.css" rel="stylesheet">
    <!--c3 CSS -->
    <link href="/admin_assets/assets/node_modules/c3-master/c3.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="/admin_assets/css/style.css" rel="stylesheet">
    <!-- Dashboard 1 Page CSS -->
    <link href="/admin_assets/css/pages/dashboard1.css" rel="stylesheet">
    <!-- You can change the theme colors from here -->
    <link href="/admin_assets/css/colors/default.css" id="theme" rel="stylesheet">
    
    <link rel="stylesheet" href="/admin_assets/css/pages/carts.css">
    
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.1/dist/sweetalert2.all.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.3.js" integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
        crossorigin="anonymous"></script>

    
</head>
<body>
    <div class="container-fluid">
        <div class="col-md-9">
          <h1>User Management</h1>
          <table class="table">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Email</th>
                <!-- <th>STATUS</th> -->
                <th>ACTION</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% if (userData.length > 0) { %>
                <% userData.forEach((user, index) => { %>
                  <tr>
                    <td><%= index + 1 %></td>
                    <td><%= user.name %></td>
                    <td><%= user.email %></td>
                    <td>
                      <% if (user.blocked===false) { %>
                        <!-- <form action="/admin/userManage/unblock" method="POST"> -->
                         <button onclick="validate2('<%= user._id %>')"class="btn btn-danger" >Block</button>

                        <!-- </form> -->
                      <% } else { %>
                        <!-- <form action="/admin/userManage/block<" method="POST"> -->
                             <button onclick="validate1('<%= user._id %>')" class="btn btn-success">UnBlock</button>

                        <!-- </form> -->
                      <% } %>
                    </td>
                  </tr>
                <% }); %>
              <% } else { %>
                <tr>
                  <td colspan="5">Users not found</td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>


      











      <script>
        function validate2(deleteId) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You wan't to block this user!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'yes,blocked!'
            }).then((result) => {
                   if (result.isConfirmed) {
                                $.ajax({
                                    url: '/admin/userManage/block/'+deleteId,
                                    method: 'get',
                                    success: (response) => {
                                        Swal.fire({
                                            title: 'blocked!',
                                            text: 'blocked',
                                            icon: 'success',
                                            showConfirmButton: false
                                        });
                                        setTimeout(() => {
                                            location.reload()
                                        }, 1000);
                                    }
                                })
                            }
                            
            })
        }

        function validate1(deleteId) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You wan't to unblock this user!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'yes,unblocked!'
            }).then((result) => {
                   if (result.isConfirmed) {
                                $.ajax({
                                    url: '/admin/userManage/unblock/'+deleteId,
                                    method: 'get',
                                    success: (response) => {
                                        Swal.fire({
                                            title: 'unblocked!',
                                            text: 'unblocked',
                                            icon: 'success',
                                            showConfirmButton: false
                                        });
                                        setTimeout(() => {
                                            location.reload()
                                        }, 1000);
                                    }
                                })
                            }
            })
        }
      </script>
      
      
</body>
</html>